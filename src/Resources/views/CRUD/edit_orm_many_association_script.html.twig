{#
This file is part of the Networking package.

(c) net working AG <info@networking.ch>
moved all relation fields to the networking crud folder

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.


This code manage the many-to-[one|many] association field popup
#}

{% autoescape false %}

    {% set associationadmin = sonata_admin.field_description.associationadmin %}

    <!-- edit many association -->
    <script type="text/javascript">
        var dialogTitle = '{{ associationadmin.label|trans({}, associationadmin.translationdomain) }}';
        var updateUrl = '{{ url('sonata_admin_short_object_information', {
            'objectId': 'OBJECT_ID',
            'uniqid': associationadmin.uniqid,
            'code': associationadmin.code
        }) }}'
        var formElementUrl = "{{ url('sonata_admin_retrieve_form_element', {
            'elementId': id,
            'subclass':  sonata_admin.admin.hasActiveSubClass()?sonata_admin.admin.getActiveSubclassCode():'',
            'objectId':  sonata_admin.admin.root.id(sonata_admin.admin.root.subject),
            'uniqid':    sonata_admin.admin.root.uniqid,
            'code':      sonata_admin.admin.root.code,
            'locale':    app.request.locale
        }) }}"
        var oneMany_{{ id }} = new OneManyAssociation('{{ id }}', dialogTitle,{{ sonata_admin.edit == 'list'?'true':'false' }} , updateUrl, formElementUrl);

        {# This code is used to defined the "add" popup #}
        // this function initialize the popup
        // this can be only done this way has popup can be cascaded
        function start_field_dialog_form_add_{{ id }}(link) {

            // remove the html event
            link.onclick = null;

            // add the jQuery event to the a element
            jQuery(link).on('click', function (event) {
                event.preventDefault();
                oneMany_{{ id }}.field_dialog_form_add(this);
            }).trigger('click');

            return false;
        }

        {% if sonata_admin.edit == 'list' %}

        {# This code is used to defined the "list" popup #}
        // this function initialize the popup
        // this can be only done this way has popup can be cascaded
        function start_field_dialog_form_list_{{ id }}(link) {

            link.onclick = null;
            // add the jQuery event to the a element
            jQuery(link).on('click', function (event) {
                event.preventDefault();
                oneMany_{{ id }}.field_dialog_form_list(this)
            }).trigger('click');
            return false;
        }

        //set up event handlers for removing an element
        function remove_selected_element_{{ id }}(link) {
            // remove the html event
            link.onclick = null;
            // add the jQuery event to the a element
            jQuery(link).on('click', function (event) {
                event.preventDefault();
                oneMany_{{ id }}.field_remove_element(this)
            }).trigger('click');
            return false;
        }
        {% endif %}


    </script>
    <!-- / edit many association -->

{% endautoescape %}
