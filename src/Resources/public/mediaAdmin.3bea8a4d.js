/*! For license information please see mediaAdmin.3bea8a4d.js.LICENSE.txt */
(()=>{"use strict";var e,t={7331(e,t,n){var a=n(3347),o=(n(1460),n(6128)),r=n.n(o),i=n(4692),l=n(4692),s=function(){var e,t,n=null,o=[],s=!0,d=!0,c="";const u=()=>{e||(t=document.querySelector("#tag_dialog"),e=new bootstrap.Modal(t,{height:"auto",width:650,show:!1}))},f=n=>{n.preventDefault();let o=n.target;axios.post(o.action,new FormData(o),axiosConfig).then(n=>{"application/json"===n.headers["content-type"]&&"ok"===n.data.result&&(e.hide(),a.x.createInitCmsMessageBox(n.data.status,n.data.message),y(n.data.json,n.data.objectId)),t.querySelector(".modal-content").innerHTML=n.data,t.querySelector("form").addEventListener("submit",f),a.x.initSpecialFields()}).catch(e=>{console.log(e)})},h=()=>{CMSApp.create_xeditable(".tag_link",{toggle:"manual",url:c,name:"name",display:function(e,t){if(void 0!==t){var n=i(".jstree-icon",this);i(this).html(n).append(e)}}},function(e,t){p(t.newValue,t.response.objectId)},function(e,t){if("save"===t){i(this).parent().closest("ul");const e=new URL(window.location.href);let t=e.searchParams;t.set("time",l.now()),e.search=t.toString(),history.replaceState({time:l.now()},"updated",e.toString())}})},p=(e,t)=>{var a=i(n).jstree(!0).get_json();g(a,e,t,a.length-1),m()},g=(e,t,n,a)=>{if(a<0)return e;var o=e[a];return void 0!==o.data&&o.data.id===n&&(o.text=t,o.li_attr["data-tag-name"]=t),o.children.length>0&&g(o.children,t,n,o.children.length-1),g(e,t,n,a-1)},m=()=>{let e=["sort","types","unique"];s&&e.push("dnd"),d&&e.push("delete");let t=i(n);o=t.data("tagsJson"),c=t.data("inlineEditUrl"),t.jstree({types:{default:{icon:"fa fa-folder text-primary fs-2x"},file:{icon:"fa fa-file text-primary fs-2x"}},plugins:e,dnd:{check_while_dragging:!0,is_draggable:e=>"show_all_media"!==e[0].a_attr.class},sort:function(e,t){let n=this.get_node(e),a=this.get_node(t);return n.data.show_first?-1:a.data.show_first||n.text.toLowerCase()>a.text.toLowerCase()?1:-1},core:{themes:{variant:"large"},check_callback:function(e,t,n,a,o){return"move_node"!==e||!n.a_attr||"show_all_media"!==n.a_attr.class},data:function(e,t){t(o)}}}),t.on("refresh.jstree",function(){h()}).on("move_node.jstree",function(e,t){let n=t.new_instance.get_json();var a=_(n,0,0,n.length-1,[]);v(a),h()}).on("after_open.jstree",function(){h()}).on("redraw.jstree",function(){h()}),t.on("dragover",function(e){})},v=e=>{axios.post(n.dataset.updateTreeUrl,{nodes:e},axiosConfig).then(function(e){var t=e.data;a.x.createInitCmsMessageBox(t.status,t.message);const n=new URL(window.location.href);let o=n.searchParams;o.set("time",l.now()),n.search=o.toString(),history.replaceState({time:l.now()},"updated",n.toString())})},_=(e,t,n,a,o)=>{if(a<0)return o;var r=e[a];return r.children.length>0&&o.push.apply(_(r.children,r.data.id,n+1,r.children.length-1,o)),o.push({id:r.data.id,parent_id:t,name:r.text,depth:n}),_(e,t,n,a-1,o)},y=(e,t)=>{o=e,i(n).jstree(!0).refresh()},b=e=>{e||(e=[]);let t=new FormData(document.querySelector("#search-form"));for(const n in e)t.append(n,e[n]);e=Object.fromEntries(t.entries()),axios.get(n.dataset.refreshListUrl,{...axiosConfig,params:e}).then(function(e){i("#item_list").html(e.data),i("html, body").animate({scrollTop:i("#item_list").scrollTop()},"slow"),w(),KTComponents.init()})},w=()=>{r()({touchNavigation:!0,loop:!0,autoplayVideos:!0,selector:".light-box-items"})};return{init:function(){n=document.querySelector("#tagsContainer"),s=n.dataset.canSort,d=n.dataset.canDelete,m(),u(),w(),KTUtil.on(document.body,"a.delete_check_box","click",function(e){e.preventDefault();let t=!1,n=document.querySelector(".batch-actions");if(document.querySelectorAll(".delete_check_box").forEach(function(e){e.checked?(e.classList.add("ui-selected"),t=!0):e.classList.remove("ui-selected")}),t)return n.classList.remove("d-none");n.classList.add("d-none")}),KTUtil.on(document.body,"a.batch","click",function(e){e.preventDefault(),document.querySelector("input[name='action']").value=e.target.dataset.value,createBatchDialog(e)}),KTUtil.on(document.body,"a.tag-dialog-link","click",function(n){n.preventDefault(),(n=>{n.preventDefault(),n.stopPropagation(),u();let a=n.target;a.getAttribute("href")||(a=a.closest("a")),fetch(a.getAttribute("href"),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.text()).then(n=>{document.querySelector("#tag_dialog").querySelector(".modal-content").innerHTML=n,e.show(),t.querySelector("form").addEventListener("submit",f)})})(n)}),KTUtil.on(document.body,".tag_link","click",function(e,t){e.preventDefault();var n=e.target.dataset.pk;void 0===t&&b({"filter[tags][value]":n})}),KTUtil.on(document.body,".show_all_media","click",function(e,t){e.preventDefault(),b({"filter[_page]":1,"filter[tags][value]":""})}),KTUtil.on(document.body,"a.media-pager","click",function(e){e.preventDefault();let t=e.target;t.getAttribute("href")||(t=t.closest("a"));let n=t.dataset.page,a=t.dataset.sortOrder,o=t.dataset.sortBy,r=t.dataset.perPage,i=t.dataset.tags,l=t.dataset.name;b({"filter[_page]":n,"filter[_sort_order]":a,"filter[_sort_by]":o,"filter[_per_page]":r,"filter[tags][value]":i,"filter[name][value]":l})}),KTUtil.on(document.body,".per-page","change",function(e){e.preventDefault();let t=e.target.value,n=e.target.dataset.page,a=e.target.dataset.sortOrder,o=e.target.dataset.sortBy,r=e.target.dataset.tags,i=e.target.dataset.name;b({"filter[_per_page]":t,"filter[_page]":n,"filter[_sort_order]":a,"filter[_sort_by]":o,"filter[tags][value]":r,"filter[name][value]":i})})},refreshList:function(e){b(e)}}}();class d{constructor(e){this.element=e,this.context=this.element.dataset.context,this.provider=this.element.dataset.provider,this.uploadForm=this.element.querySelector("#upload-form");const t=this.element.dataset.uniqueId;let n=this.element.querySelector(".dropzone-item");n.id="";let a=n.parentNode.innerHTML;n.parentNode.removeChild(n);const o=this;let r=new Dropzone(this.element,{init:function(){this.on("success",function(e,t){o.changeButtonRow(e,t),s.refreshList()}),this.on("error",function(e,t){t.duplicate&&o.changeButtonRow(e,t)})},url:this.uploadForm.action,params:{context:this.context,provider:this.provider,oneuploader:!0},thumbnailWidth:80,thumbnailHeight:80,parallelUploads:20,previewTemplate:a,previewsContainer:"#previews",clickable:".fileinput-zone"});r.on("totaluploadprogress",function(e){document.querySelector("#total-progress .progress-bar").style.width=e+"%"}),r.on("sending",function(e,n,a){let o=document.querySelector("#"+t+"_tags").value;a.append("tags",o),document.querySelector("#total-progress").style.opacity="1"}),r.on("queuecomplete",function(e){document.querySelector("#total-progress").style.opacity="0"}),document.querySelector("#actions .cancel").onclick=function(){r.removeAllFiles(!0)}}changeButtonRow(e,t){let n=e.previewElement.querySelector("[data-dz-url]");n.href=t.url,n.classList.remove("d-none"),e.previewElement.querySelector(".progress").classList.add("d-none")}}!function(e){var t=document.createElement("a");t.className="delete-tag dialog-link float-end ",t.innerHTML='<i class="la la-trash fs-2 mx-3"></i>',e.jstree.defaults.delete=e.noop,e.jstree.plugins.delete=function(n,a){this.teardown=function(){this.settings.delete&&this.element.find(".delete-tag").remove(),a.teardown.call(this)},this.redraw_node=function(n,o,r,i){if(n=a.redraw_node.call(this,n,o,r,i),this.get_node(n).children&&this.get_node(n).children.length)return n;if(n&&e(n).hasClass("sortable-tag")){var l=t.cloneNode(!0),s=this.get_node(n);l.href=s.data.delete_link,n.insertBefore(l,n.childNodes[2])}return n}}}(i),KTUtil.onDOMContentLoaded(function(){s.init(),document.body.addEventListener("shown.bs.modal",function(e){let t=e.target.querySelector("#dropzone_area");t&&new d(t)})})}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;if(void 0===t[e]){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,a),i.exports}a.m=t,e=[],a.O=(t,n,o,r)=>{if(!n){var i=1/0;for(c=0;c<e.length;c++){for(var[n,o,r]=e[c],l=!0,s=0;s<n.length;s++)(!1&r||i>=r)&&Object.keys(a.O).every(e=>a.O[e](n[s]))?n.splice(s--,1):(l=!1,r<i&&(i=r));if(l){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,o,r]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={790:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var o,r,[i,l,s]=n,d=0;if(i.some(t=>0!==e[t])){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(s)var c=s(a)}for(t&&t(n);d<i.length;d++)r=i[d],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},n=self.webpackChunkinit_cms_bundle=self.webpackChunkinit_cms_bundle||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=a.O(void 0,[460,136,692,128,347],()=>a(7331));o=a.O(o)})();
//# sourceMappingURL=mediaAdmin.3bea8a4d.js.map