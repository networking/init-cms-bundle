"use strict";var sourcemaps=require("rollup-plugin-sourcemaps"),umdName="MobileDragDrop";module.exports=function(e){e.initConfig({pkg:e.file.readJSON("package.json"),uglify:{options:{mangle:{reserved:[umdName]},mangleProperties:{regex:/^_/},reserveDOMProperties:!0,compress:{drop_console:!0,drop_debugger:!0,dead_code:!0,unused:!0,sequences:!0,if_return:!0,join_vars:!0,keep_fargs:!0,conditionals:!0,evaluate:!0},sourceMap:!0,report:"min"},main:{options:{banner:"/*! <%= pkg.name %> <%= pkg.version %> | Copyright (c) <%= grunt.template.today('yyyy') %> Tim Ruffles | MIT License */",sourceMapIn:"src/index.js.map"},src:"src/index.js",dest:"src/index.min.js"},scroll:{options:{sourceMapIn:"src/scroll-behaviour.js.map"},src:"src/scroll-behaviour.js",dest:"src/scroll-behaviour.min.js"}},connect:{dev:{options:{port:8e3,open:"http://localhost:8000/demo/",livereload:35731,middleware:function(e,s,r){return r.unshift((function(e,s,r){var a=/\/release\//;if(a.test(e.url)){var o=e.url.replace(a,"/src/");e.url=o.replace(".min","")}r()})),r}}},release:{options:{port:8001,open:"http://localhost:8001/demo/"}}},ts:{build:{tsconfig:!0}},tslint:{options:{configuration:"tslint.json"},files:{src:["src/*.ts","!src/*.d.ts"]}},rollup:{options:{sourceMap:!0,format:"umd",moduleName:umdName,plugins:function(){return[sourcemaps()]}},build:{files:{"src/index.js":"src/index.js","src/scroll-behaviour.js":"src/scroll-behaviour.js"}}},append:{umdDeclaration:{append:"export as namespace "+umdName+";",files:{"src/index.d.ts":"src/index.d.ts","src/scroll-behaviour.d.ts":"src/scroll-behaviour.d.ts"}}},clean:{release:["release"]},copy:{release:{files:[{expand:!0,cwd:"src",src:["*.css","*.d.ts","*.js","*.map"],dest:"release/",filter:"isFile",flatten:!0},{src:"package.json",dest:"release/"}]}},watch:{ts:{files:["src/**/*.ts","!src/**/*.d.ts"],tasks:["compile"],options:{debounceDelay:250,atBegin:!0,livereload:35731}},resources:{files:["src/**/*.css","demo/**/*"],options:{debounceDelay:500,livereload:35731}}},bump:{options:{files:["package.json","bower.json"],updateConfigs:["pkg"],commit:!0,commitMessage:"Release v%VERSION%",commitFiles:["package.json","bower.json","CHANGELOG.md","release"],createTag:!0,tagName:"v%VERSION%",tagMessage:"Version %VERSION%",push:!0,pushTo:"origin",gitDescribeOptions:"--tags --always --abbrev=1 --dirty=-d",globalReplace:!1,prereleaseName:"alpha",metadata:"",regExp:!1}}}),e.loadNpmTasks("grunt-contrib-uglify"),e.loadNpmTasks("grunt-contrib-connect"),e.loadNpmTasks("grunt-contrib-clean"),e.loadNpmTasks("grunt-contrib-copy"),e.loadNpmTasks("grunt-contrib-watch"),e.loadNpmTasks("grunt-ts"),e.loadNpmTasks("grunt-tslint"),e.loadNpmTasks("grunt-npm"),e.loadNpmTasks("grunt-bump"),e.loadNpmTasks("grunt-rollup"),e.registerMultiTask("append",(function(){var s=this.data.append||"";this.files.forEach((function(r){r.src.filter((function(s){return!!e.file.exists(s)||(e.log.warn('Source file "'+s+'" not found.'),!1)})).map((function(r){return e.file.read(r)+s})).forEach((function(a){e.file.write(r.dest,a),e.log.writeln('Appended "'+s+'" saved to "'+r.dest+'".')}))}))})),e.registerTask("compile",["ts","rollup","append:umdDeclaration"]),e.registerTask("build-release",["compile","tslint","uglify","clean","copy"]),e.registerTask("prepare-release","Prepare a release by building release files and bumping version",(function(s){s?e.task.run("build-release","bump-only:"+s,"copy"):e.log.error("You must specify the version bump! See https://github.com/vojtajina/grunt-bump/tree/v0.7.0")})),e.registerTask("serve-release","serve release files for checking that release files have no issues",["connect:release","watch:resources"]),e.registerTask("publish-release",["bump-commit"]),e.registerTask("default",["connect:dev","watch"])};