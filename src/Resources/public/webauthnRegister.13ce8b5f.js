/*! For license information please see webauthnRegister.13ce8b5f.js.LICENSE.txt */
(()=>{"use strict";var t,e,n,i,s,a,r={130(t,e,n){n.d(e,{J4:()=>a,nZ:()=>o,u$:()=>r,wq:()=>s});var i=n(4461);async function s(t,e=""){!e||e instanceof FormData||(e=JSON.stringify(e));const n=await fetch(t,{method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:e});if(200===n.status||201===n.status)return n.json();{const t=await n.json();if(t.message)throw new Error(t.message);throw new Error(t.error)}}async function a(t,e){let n={username:t,displayName:e,authenticatorSelection:{userVerification:"preferred"}};const a=await s("/admin/register/options",n);let r;try{r=await(0,i.Ct)(a)}catch(t){throw t}return await s(CMSRouting.generate("initcms_webauthn_register_response"),r)}async function r(t){return s(CMSRouting.generate("admin_networking_initcms_user_remove_webauthn_key")+`?credId=${encodeURIComponent(t)}`)}async function o(t,e){return s(CMSRouting.generate("admin_networking_initcms_user_rename_webauthn_key")+`?credId=${encodeURIComponent(t)}&name=${encodeURIComponent(e)}`)}},3048(t,e,n){n.a(t,async(t,e)=>{try{var i=n(6752),s=n(4461),a=n(130);let r=await CMSAdmin.getTranslator();const o=document.querySelectorAll(".create-passkey"),c=document.querySelector("#test-signin"),l=(document.querySelector("#delete-authenticator"),document.querySelector("#create-authenticator")),u=(document.querySelector("#current-authenticator"),document.querySelector("meta[name='webauthn-enabled']").getAttribute("content")),d=document.querySelector("meta[name='google-authenticator-enabled']").getAttribute("content");async function m(t){let e=t.target;e.classList.contains("btn")||(e=e.closest(".btn"));const{credId:n,name:i}=e.dataset;try{const{value:t,isConfirmed:e}=await Swal.fire({title:r.trans("passkey_rename.title",[],"security"),inputLabel:r.trans("passkey_rename.input_label",[],"security"),input:"text",inputValue:i,inputValidator:t=>{if(!t)return r.trans("passkey_rename.input_invalid",[],"security")},buttonsStyling:!1,showCancelButton:!0,confirmButtonText:r.trans("submit",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),reverseButtons:!0,customClass:{confirmButton:"btn btn-sm btn-primary",cancelButton:"btn btn-sm btn-light"}});e&&(await(0,a.nZ)(n,t),b())}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function g(t){Swal.fire({title:r.trans("passkey_delete.title",[],"security"),text:r.trans("passkey_delete.text",[],"security"),icon:"warning",buttonsStyling:!1,showCancelButton:!0,confirmButtonText:r.trans("delete",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),reverseButtons:!0,customClass:{confirmButton:"btn btn-sm btn-danger",cancelButton:"btn btn-sm btn-light"}}).then(async e=>{if(!e.isConfirmed)return;let n=t.target;n.classList.contains("btn")||(n=n.closest(".btn"));try{await(0,a.u$)(n.dataset.credId),b()}catch(t){alert(t.message)}})}async function b(){try{let t=await(0,a.wq)(CMSRouting.generate("admin_networking_initcms_user_get_webauthn_keys"));const e=document.querySelector("#list");document.querySelector("#passkeys-setup").classList.toggle("d-none",t.length<1),document.querySelector("#passkeys-not-setup").classList.toggle("d-none",t.length>0);const n=i.qy`${t.length>0?i.qy`

                <ul class="list-group">
                      ${t.map(t=>i.qy`
                          <li class="list-group-item d-flex justify-content-between align-items-start">
                              <div>
                                 <img src="${t.icon}" class="w-25px">
                              </div>
                              <div class="w-75">
                                  <div>${t.name||"Unnamed"}</div>
                                  <div class="text-muted">${t.createdAt}</div>
                              </div>
                              <div class="buttons">

                                  <button data-cred-id="${t.id}" @click="${m}" data-name="${t.name}"
                                          class=" btn btn-light btn-sm "
                                          data-bs-toggle="tooltip"
                                          data-bs-placement="bottom" aria-label="${r.trans("action_edit",[],"SonataAdminBundle")}"
                                          data-bs-original-title="${r.trans("action_edit",[],"SonataAdminBundle")}"
                                          title="${r.trans("action_edit",[],"SonataAdminBundle")}">
                                      <i class="ki-outline ki-pencil fs-3"></i>
                                  </button>

                                  <button data-cred-id="${t.id}" @click="${g}"
                                          class="btn btn-light btn-sm"
                                          data-bs-toggle="tooltip"
                                          data-bs-placement="bottom"
                                          aria-label="${r.trans("action_delete",[],"SonataAdminBundle")}" 
                                          data-bs-original-title="${r.trans("action_delete",[],"SonataAdminBundle")}"
                                          title="${r.trans("action_delete",[],"SonataAdminBundle")}">
                                      <i class="ki-outline ki-trash fs-3 "></i>
                                  </button>
                              </div>
                          </li>`)}
                  </ul>`:i.qy`
                <ul class="list-group">
                    <li  class="list-group-item">${r.trans("passkey_create.no_credentials_found",[],"security")}</li>
                  </ul>`}`;(0,i.XX)(n,e),o.forEach(t=>{t.classList.remove("d-none")})}catch(t){document.querySelector("#show-passkeys").classList.add("d-none"),CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function y(){try{let t=await(0,a.wq)(CMSRouting.generate("admin_networking_initcms_user_profile_security_get_authenticator"));const e=document.querySelector("#list-authenticator");l.classList.toggle("d-none",t.hasStepVerificationCode);const n=i.qy`${t.hasStepVerificationCode?i.qy`
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-start">
                    <div>
                        <img src="${t.qrCodeUrl}" class="w-150px">
                    </div>
                    <div class="w-75">
                        <div><strong>${r.trans("authenticator_edit.current_authenticator",[],"security")}</strong></div>
                        <div class="text-muted">${t.secret}</div>
                    </div>
                    <div class="buttons">
                        <button id="edit-authenticator" type="button" @click="${w}"
                                class="btn btn-light btn-sm"
                                data-bs-toggle="tooltip"
                                data-bs-placement="bottom"
                                aria-label="${r.trans("action_edit",[],"SonataAdminBundle")}"
                                data-bs-original-title="${r.trans("action_edit",[],"SonataAdminBundle")}">
                            <i class="ki-outline ki-pencil fs-3 "></i>
                        </button>
                    </div>
                </li>
              </ul>`:i.qy`
            <ul class="list-group">
                <li class="list-group-item">${r.trans("authenticator_edit.no_authenticator_found",[],"security")}</li>
              </ul>`}`;(0,i.XX)(n,e)}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function p(){try{let t=document.querySelector('meta[name="username"]').getAttribute("content"),e=document.querySelector('meta[name="displayName"]').getAttribute("content");await(0,a.J4)(t,e),b()}catch(t){"InvalidStateError"===t.name?Swal.fire({title:r.trans("passkey_create.passkey_exists_for_device_method",[],"security"),html:'<div class="d-flex flex-column align-items-center">\n                    <div class="stack w-150px position-relative">\n                        <img src="/bundles/networkinginitcms/img/fido/face-id.svg" alt="WebAuthn" class="position-absolute top-50 w-25px">\n                        <img src="/bundles/networkinginitcms/img/fido/fingerprint.svg" alt="WebAuthn" class="position-absolute top-25 end-0 w-30px">\n                        <img src="/bundles/networkinginitcms/img/fido/passkey-local.svg" alt="WebAuthn" class="w-50px position-absolute top-50 start-50 translate-middle">\n                        <img src="/bundles/networkinginitcms/img/fido/phone.svg" alt="WebAuthn" class="w-150px">\n                        <img src="/bundles/networkinginitcms/img/fido/password.svg" alt="WebAuthn" class="w-30px position-absolute bottom-25 end-0">\n                    </div>\n                </div>\n',buttonsStyling:!1,showCancelButton:!1,confirmButtonText:r.trans("continue",[],"security"),customClass:{htmlContainer:"h-100",confirmButton:"btn btn-sm btn-success"}}):"NotAllowedError"===t.name||CMSAdmin.createInitCmsMessageBox("error",t.message)}}function f(){Swal.fire({title:r.trans("passkey_create.title",[],"security"),html:`<div class="d-flex flex-column align-items-center">\n                    <div class="stack w-150px position-relative">\n                        <img src="/bundles/networkinginitcms/img/fido/face-id.svg" alt="WebAuthn" class="position-absolute top-50 w-25px">\n                        <img src="/bundles/networkinginitcms/img/fido/fingerprint.svg" alt="WebAuthn" class="position-absolute top-25 end-0 w-30px">\n                        <img src="/bundles/networkinginitcms/img/fido/passkey-local.svg" alt="WebAuthn" class="w-50px position-absolute top-50 start-50 translate-middle">\n                        <img src="/bundles/networkinginitcms/img/fido/phone.svg" alt="WebAuthn" class="w-150px">\n                        <img src="/bundles/networkinginitcms/img/fido/password.svg" alt="WebAuthn" class="w-30px position-absolute bottom-25 end-0">\n                    </div>\n                    <p>${r.trans("passkey_create.text",[],"security")}</p>\n                </div>\n`,buttonsStyling:!1,showCancelButton:!0,confirmButtonText:r.trans("continue",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),customClass:{htmlContainer:"h-100",confirmButton:"btn btn-sm btn-primary",cancelButton:"btn btn-sm btn-light"}}).then(t=>{t.isConfirmed&&p()})}async function h(){try{const t=await(0,a.wq)(CMSRouting.generate("admin_networking_initcms_user_profile_security_create_authenticator"));let e=t.qrCodeUrl,n=t.secret;Swal.fire({title:r.trans("authenticator_edit.setup_authenticator_title",[],"security"),html:`<div class="d-flex flex-column align-items-center">\n                    ${r.trans("authenticator_edit.setup_authenticator_text",[],"security")}\n                    <div class="stack w-150px position-relative">\n                        <img src="${e}"  class="w-150px">\n                    </div>\n                    \n                    <p>${r.trans("authenticator_edit.setup_authenticator_text2",[],"security")}</p>\n                    \n                    <div class="w-250px">\n                        <code>${n}</code>\n                </div>\n`,buttonsStyling:!1,showCancelButton:!0,confirmButtonText:r.trans("next",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),customClass:{htmlContainer:"h-100",confirmButton:"btn btn-primary",cancelButton:"btn btn-light"}}).then(t=>{t.isConfirmed&&_()})}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function _(){try{const{value:t,isDenied:e}=await Swal.fire({title:r.trans("authenticator_edit.verify_code_title",[],"security"),inputLabel:r.trans("authenticator_edit.verify_code_text",[],"security"),input:"text",inputAttributes:{autocomplete:"one-time-code"},buttonsStyling:!1,showCancelButton:!0,showDenyButton:!0,denyButtonText:r.trans("back",[],"security"),confirmButtonText:r.trans("confirm",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),reverseButtons:!0,customClass:{denyButton:"btn btn-light-primary",confirmButton:"btn btn-primary",cancelButton:"btn btn-light"}});if(e)return h();if(t){let e=await(0,a.wq)(CMSRouting.generate("admin_networking_initcms_user_profile_security_verify_authenticator"),{_code:t});e&&"ok"===e.status&&(Swal.fire({text:r.trans("test.success_text",[],"security"),icon:"success",buttonsStyling:!1,confirmButtonText:r.trans("continue",[],"security"),customClass:{confirmButton:"btn btn-primary"}}),y())}}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function w(){try{const{isConfirmed:t}=await Swal.fire({title:r.trans("authenticator_edit.change_authenticator_title",[],"security"),text:r.trans("authenticator_edit.change_authenticator_text",[],"security"),buttonsStyling:!1,showCancelButton:!0,confirmButtonText:r.trans("edit",[],"security"),cancelButtonText:r.trans("cancel",[],"security"),customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-light"}});t&&h()}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}async function v(){const t=await(0,a.wq)("/admin/assertion/options",{requireUserVerification:"preferred"});let e;try{e=await(0,s.HS)(t)}catch(t){return void CMSAdmin.createInitCmsMessageBox("error",t.message)}try{const t=await(0,a.wq)("/admin/assertion",e);if(t&&"ok"===t.status)return void Swal.fire({text:r.trans("test.success_text",[],"security"),icon:"success",buttonsStyling:!1,confirmButtonText:r.trans("continue",[],"security"),customClass:{confirmButton:"btn btn-primary"}});throw new Error("User not found.")}catch(t){CMSAdmin.createInitCmsMessageBox("error",t.message)}}if(u){if((0,s.zZ)()&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable&&PublicKeyCredential.isConditionalMediationAvailable)try{(await Promise.all([(0,s.c9)(),(0,s.ZF)()])).every(t=>!0===t)?b():document.querySelector("#message").innerText=r.trans("passkey_create.webauthn_not_available",[],"security")}catch(x){CMSAdmin.createInitCmsMessageBox("error",x)}else document.querySelector("#message").innerText=r.trans("passkey_create.webauthn_not_available",[],"security");o.forEach(t=>{t.addEventListener("click",f)}),c.addEventListener("click",v)}d&&(y(),l.addEventListener("click",h)),e()}catch(S){e(S)}},1)}},o={};function c(t){var e=o[t];if(void 0!==e)return e.exports;if(void 0===r[t]){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[t]={exports:{}};return r[t](i,i.exports,c),i.exports}c.m=r,t="function"==typeof Symbol,e=t?Symbol("webpack queues"):"__webpack_queues__",n=t?Symbol("webpack exports"):"__webpack_exports__",i=t?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach(t=>t.r--),t.forEach(t=>t.r--?t.r++:t()))},c.a=(t,a,r)=>{var o;r&&((o=[]).d=-1);var c,l,u,d=new Set,m=t.exports,g=new Promise((t,e)=>{u=e,l=t});g[n]=m,g[e]=t=>(o&&t(o),d.forEach(t),g.catch(t=>{})),t.exports=g,a(t=>{var a;c=(t=>t.map(t=>{if(null!==t&&"object"==typeof t){if(t[e])return t;if(t.then){var a=[];a.d=0,t.then(t=>{r[n]=t,s(a)},t=>{r[i]=t,s(a)});var r={};return r[e]=t=>t(a),r}}var o={};return o[e]=t=>{},o[n]=t,o}))(t);var r=()=>c.map(t=>{if(t[i])throw t[i];return t[n]}),l=new Promise(t=>{(a=()=>t(r)).r=0;var n=t=>t!==o&&!d.has(t)&&(d.add(t),t&&!t.d&&(a.r++,t.push(a)));c.map(t=>t[e](n))});return a.r?l:r()},t=>(t?u(g[i]=t):l(m),s(o))),o&&o.d<0&&(o.d=0)},a=[],c.O=(t,e,n,i)=>{if(!e){var s=1/0;for(u=0;u<a.length;u++){for(var[e,n,i]=a[u],r=!0,o=0;o<e.length;o++)(!1&i||s>=i)&&Object.keys(c.O).every(t=>c.O[t](e[o]))?e.splice(o--,1):(r=!1,i<s&&(s=i));if(r){a.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}i=i||0;for(var u=a.length;u>0&&a[u-1][2]>i;u--)a[u]=a[u-1];a[u]=[e,n,i]},c.d=(t,e)=>{for(var n in e)c.o(e,n)&&!c.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},c.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={542:0};c.O.j=e=>0===t[e];var e=(e,n)=>{var i,s,[a,r,o]=n,l=0;if(a.some(e=>0!==t[e])){for(i in r)c.o(r,i)&&(c.m[i]=r[i]);if(o)var u=o(c)}for(e&&e(n);l<a.length;l++)s=a[l],c.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return c.O(u)},n=self.webpackChunkinit_cms_bundle=self.webpackChunkinit_cms_bundle||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var l=c.O(void 0,[852],()=>c(3048));l=c.O(l)})();
//# sourceMappingURL=webauthnRegister.13ce8b5f.js.map