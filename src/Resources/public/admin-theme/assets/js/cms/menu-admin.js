var CMSMenuAdmin=function(){var e,t,a,n,r=localStorage.getItem("lastTab"),o=!1,l=[],i=()=>{axios.get(a.dataset.listUrl,{locale:document.querySelector("#filter_locale_value").value,...axiosConfig}).then((function(e){a.innerHTML=e.data.html,e.data.hasOwnProperty("last_edited")>-1&&f(e.data.last_edited),u(),$('a[href="'+r+'"]').tab("show")}))},d=e=>{r=e,localStorage.setItem("lastTab",r)},c=e=>{e.preventDefault();let a=e.target;a.getAttribute("href")||(a=a.closest("a"));let n=document.querySelector("#filter_locale_value").value;axios.get(a.getAttribute("href"),{locale:n,...axiosConfig}).then((function(e){document.querySelector("#menu_dialog").querySelector(".modal-content").innerHTML=e.data,t.show(),CMSAdmin.createSelect2()}))},s=e=>{e.preventDefault(),e.stopPropagation();let a=e.target;axios.post(a.action,new FormData(a),axiosConfig).then((function(e){var a=e.data;"ok"==a.result&&(a.is_new_menu_item&&a.html?document.querySelector("#menu_dialog").querySelector(".modal-content").innerHTML=a.html:(t.hide(),CMSAdmin.createInitCmsMessageBox(a.status,a.message)),i())})).catch((function(e){return!1}))},u=()=>{$("div.menu_tree").each((function(e,t){let a=$(t);l.push(a);let n=a.data("tree"),r=["dnd","types","changed"];"placement_menu"!==a.attr("id")&&(r.push("externalUrl"),r.push("delete")),a.jstree({types:{default:{icon:"la la-file text-primary fs-2x"},file:{icon:"la la-file text-primary fs-2x"}},plugins:r,core:{themes:{variant:"large"},check_callback:!0,data:function(e,t){t(n)}}});let i=document.querySelector('[data-tree-id="'+a.attr("id")+'"]');a.on("move_node.jstree",(function(e,t){g(t.new_instance.get_json(),"placement_menu"===$(t.new_instance.element[0]).attr("id")),i&&i.checked&&p(i)})),a.on("after_close.jstree",(function(e,t){i.checked=!1})),o||a.on("ready.jstree",(function(){o=!0,m()}))}))},m=()=>{document.querySelectorAll("[data-tree-id]").forEach((function(e){p(e)}))},f=t=>{e=t},h=(e,t,a,n,r)=>{var o=a+1,l=e.data.id;return e.children.length>0&&(t++,e.children.forEach((function(e){o=h(e,t,o,n,l)})),t--),l&&n.push({name:e.text,item_id:l,parent_id:r,depth:t,left:a,right:o}),a=o+1},g=(e,a)=>{var r=[],o=2;e.forEach((function(e){o=h(e,1,o,r,e.data.rootId)})),r=r.sort((function(e,t){return e.left-t.left})),axios.post(n,{nodes:r},axiosConfig).then((function(e){CMSAdmin.createInitCmsMessageBox("success",e.data.message),t.hide(),a&&i()}))},_=e=>{let t=e.target;p(t)},p=e=>{let t=e.dataset.treeId,a=e.checked;localStorage.setItem("tree_"+t,a),l.find((e=>{if(e.attr("id")===t)return a?e.jstree(!0).open_all():e.jstree(!0).close_all()}))};return{init:function(){(()=>{if(a=document.querySelector("#menuTabs"),r=localStorage.getItem("lastTab"),e=a.dataset.lastEdited,a.dataset.listUrl,n=a.dataset.updateUrl,document.querySelectorAll("[data-tree-id]").forEach((function(e){e.checked="false"!==localStorage.getItem("tree_"+e.dataset.treeId)})),u(),KTUtil.on(document.querySelector("#menuTabs"),".menu-dialog-link","click",c),KTUtil.on(document.querySelector("#menu_dialog"),"form","submit",s),KTUtil.on(document.querySelector("#menuTabs"),".tree-show-all","click",_),$("body").on("shown.bs.tab",(function(e){d($(e.target).attr("href"))})),e){var t=$("#menu-item-"+e);r="#menu_"+t.data("root-id"),d(r)}r&&$('a[href="'+r+'"]').tab("show")})(),t||(t=new bootstrap.Modal(document.querySelector("#menu_dialog"),{height:"auto",width:650,show:!1}))},reload:function(){i()}}}();!function(e,t){"use strict";var a=document.createElement("a");a.className="external-url float-end",e.jstree.defaults.externalUrl=e.noop,e.jstree.plugins.externalUrl=function(e,t){this.teardown=function(){this.settings.externalUrl&&this.element.find(".external-url").remove(),t.teardown.call(this)},this.redraw_node=function(e,n,r,o){e=t.redraw_node.call(this,e,n,r,o);var l=this.get_node(e),i=a.cloneNode(!0);return i.href=l.data.externalUrl,i.innerHTML=l.data.path,e.insertBefore(i,e.childNodes[2]),e}};var n=document.createElement("a");n.className="delete-tag menu-dialog-link float-end ",n.innerHTML='<i class="la la-trash fs-2 mx-3"></i>',e.jstree.defaults.delete=e.noop,e.jstree.plugins.delete=function(e,t){this.teardown=function(){this.settings.delete&&this.element.find(".delete-tag").remove(),t.teardown.call(this)},this.redraw_node=function(e,a,r,o){e=t.redraw_node.call(this,e,a,r,o);var l=n.cloneNode(!0),i=this.get_node(e);return l.href=i.data.deleteUrl,e.insertBefore(l,e.childNodes[2]),e}}}($),KTUtil.onDOMContentLoaded((function(){CMSMenuAdmin.init()}));
//# sourceMappingURL=menu-admin.js.map
