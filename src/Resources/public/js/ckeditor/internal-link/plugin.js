CKEDITOR.plugins.add("internal_link",{lang:["de","en"],requires:"ajax"}),CKEDITOR.on("dialogDefinition",function(e){if("link"===e.data.name){var n=JSON.parse(CKEDITOR.ajax.load("/cms/pages/internal-url.json?")),t=e.data.definition.getContents("info");e.data.definition.onLoad=function(){var e=this.getContentElement("info","linkType"),n=this.getContentElement("info","internalinkOptions");$("#"+e.domId).on("change",function(){"url"===e.getValue()?n.getElement().show():n.getElement().hide()})},t.add({type:"vbox",id:"internalinkOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{type:"select",id:"locale",label:e.editor.lang.internal_link.locale,style:"width:100%",items:n.locales,onChange:function(){var n=this.getValue(),t=JSON.parse(CKEDITOR.ajax.load("/cms/pages/internal-url.json?_locale="+n)),a=this.getDialog().getContentElement("info","intern");a.clear(),a.add(e.editor.lang.internal_link.select,""),t.pages.forEach(function(e){a.add(e.name,e.url)})},commit:function(e){CKEDITOR.dialog.getCurrent().setValueOf("advanced","advLangCode",this.getValue())},setup:function(e){this.allowOnChange=!1,this.setValue(e.advanced?e.advanced.advLangCode:n.locales[0][1]),this.allowOnChange=!0}},{type:"select",id:"intern",label:e.editor.lang.internal_link.internal_link,style:"width:100%",items:[[e.editor.lang.internal_link.select,null]],onChange:function(){var e=CKEDITOR.dialog.getCurrent();e.setValueOf("info","url",this.getValue()),e.setValueOf("info","protocol",this.getValue()?"":"http://")},setup:function(e){this.allowOnChange=!1,this.setValue(e.url?e.url.url:""),this.allowOnChange=!0}}]}]},"urlOptions")}});