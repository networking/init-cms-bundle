/*! For license information please see plugin.js.LICENSE.txt */
CKEDITOR.plugins.add("wordcount",{lang:"ar,bg,ca,cs,da,de,el,en,es,eu,fa,fi,fr,he,hr,hu,it,ko,ja,nl,no,pl,pt,pt-br,ru,sk,sv,tr,uk,zh-cn,zh",version:"1.17.3",requires:"htmlwriter,notification,undo",bbcodePluginLoaded:!1,onLoad:function(){CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css")},init:function(n){var a="",t=-1,r=-1,o=-1,e=!1,u=n.getSnapshot(),i=0,h=null,c=function(n,a,t){if(void 0!==document.dispatchEvent){var r;n="ckeditor.wordcount."+n;var o={bubbles:!1,cancelable:!0,detail:{currentLength:a,maxLength:t}};try{r=new CustomEvent(n,o)}catch(a){(r=document.createEvent("CustomEvent")).initCustomEvent(n,o.bubbles,o.cancelable,o.detail)}document.dispatchEvent(r)}},s={showRemaining:!1,showParagraphs:!0,showWordCount:!0,showCharCount:!1,countBytesAsChars:!1,countSpacesAsChars:!1,countHTML:!1,countLineBreaks:!1,hardLimit:!0,maxWordCount:-1,maxCharCount:-1,maxParagraphs:-1,filter:null,pasteWarningDuration:0,wordCountGreaterThanMaxLengthEvent:function(n,a){c("wordCountGreaterThanMaxLengthEvent",n,a)},charCountGreaterThanMaxLengthEvent:function(n,a){c("charCountGreaterThanMaxLengthEvent",n,a)},wordCountLessThanMaxLengthEvent:function(n,a){c("wordCountLessThanMaxLengthEvent",n,a)},charCountLessThanMaxLengthEvent:function(n,a){c("charCountLessThanMaxLengthEvent",n,a)}},d=CKEDITOR.tools.extend(s,n.config.wordcount||{},!0);d.showParagraphs&&(d.maxParagraphs>-1?d.showRemaining?a+="%paragraphsCount% "+n.lang.wordcount.ParagraphsRemaining:(a+=n.lang.wordcount.Paragraphs+" %paragraphsCount%",a+="/"+d.maxParagraphs):a+=n.lang.wordcount.Paragraphs+" %paragraphsCount%"),d.showParagraphs&&(d.showWordCount||d.showCharCount)&&(a+=", "),d.showWordCount&&(d.maxWordCount>-1?d.showRemaining?a+="%wordCount% "+n.lang.wordcount.WordCountRemaining:(a+=n.lang.wordcount.WordCount+" %wordCount%",a+="/"+d.maxWordCount):a+=n.lang.wordcount.WordCount+" %wordCount%"),d.showCharCount&&d.showWordCount&&(a+=", "),d.showCharCount&&(d.maxCharCount>-1?d.showRemaining?a+="%charCount% "+n.lang.wordcount[d.countHTML?"CharCountWithHTMLRemaining":"CharCountRemaining"]:(a+=n.lang.wordcount[d.countHTML?"CharCountWithHTML":"CharCount"]+" %charCount%",a+="/"+d.maxCharCount):a+=n.lang.wordcount[d.countHTML?"CharCountWithHTML":"CharCount"]+" %charCount%");var C=a;function l(n){return"cke_wordcount_"+n.name}function g(n){return document.getElementById(l(n))}function p(n){if(bbcodePluginLoaded)return n.replace(/\[.*?\]/gi,"");var a=document.createElement("div");return n=m(n),a.innerHTML=n,""==a.textContent&&void 0===a.innerText?"":a.textContent||a.innerText}function m(n){if(d.filter instanceof CKEDITOR.htmlParser.filter){var a=CKEDITOR.htmlParser.fragment.fromHtml(n),t=new CKEDITOR.htmlParser.basicWriter;return d.filter.applyTo(a),a.writeHtml(t),t.getHtml()}return n}function w(a){if(d.countHTML)return m(a).length;var t;if(n.config.fullPage){var r=a.search(new RegExp("<body>","i"));if(-1!=r){var o=a.search(new RegExp("</body>","i"));a=a.substring(r+6,o)}}return t=a,d.countSpacesAsChars||(t=a.replace(/\s/g,"").replace(/&nbsp;/g,"")),t=p(t=d.countLineBreaks?t.replace(/(\r\n|\n|\r)/gm,""):t.replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," ")).replace(/^([\t\r\n]*)$/,""),d.countBytesAsChars?function(n){var a,t=0,r=n.length;for(n=String(n||""),a=0;a<r;a++){var o=encodeURI(n[a]).split("%").length;t+=1==o?1:o-1}return t}(t):t.length}function x(n){return n.replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/gi,"").replace(/^\s*$[\n\r]{1,}/gm,"++").split("++").length}function f(n){for(var a=n.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," "),t=(a=p(a)).split(/\s+/),r=t.length-1;r>=0;r--)t[r].match(/^([\s\t\r\n]*)$/)&&t.splice(r,1);return t.length}function L(a){if(g(a)){var i,h=0,c=0,s=0;a.fire("beforeGetData",{firedBy:"wordCount.updateCounter"},n),i=a.getData(!0),a.fire("getData",{dataValue:i,firedBy:"wordCount.updateCounter"},n),i&&(d.showCharCount&&(s=w(i)),d.showParagraphs&&(h=x(i)),d.showWordCount&&(c=f(i)));var l=C;if(d.showRemaining?(l=d.maxCharCount>=0?l.replace("%charCount%",d.maxCharCount-s):l.replace("%charCount%",s),l=d.maxWordCount>=0?l.replace("%wordCount%",d.maxWordCount-c):l.replace("%wordCount%",c),l=d.maxParagraphs>=0?l.replace("%paragraphsCount%",d.maxParagraphs-h):l.replace("%paragraphsCount%",h)):l=l.replace("%wordCount%",c).replace("%charCount%",s).replace("%paragraphsCount%",h),(a.config.wordcount||(a.config.wordcount={})).wordCount=c,(a.config.wordcount||(a.config.wordcount={})).charCount=s,CKEDITOR.env.gecko?g(a).innerHTML=l:g(a).innerText=l,s==r&&c==t&&h==o)return(s==d.maxCharCount||c==d.maxWordCount||h>d.maxParagraphs)&&(u=n.getSnapshot()),!0;var p=c-t,m=s-r,L=h-o;return-1==(t=c)&&(t=c),-1==(r=s)&&(r=s),-1==(o=h)&&(o=h),d.maxWordCount>-1&&c>d.maxWordCount&&p>0||d.maxCharCount>-1&&s>d.maxCharCount&&m>0||d.maxParagraphs>-1&&h>d.maxParagraphs&&L>0?function(a,t){e=!0,d.hardLimit&&(a.loadSnapshot(u),a.config.Locked=1),t||(g(a).className="cke_path_item cke_wordcountLimitReached",a.fire("limitReached",{firedBy:"wordCount.limitReached"},n))}(a,e):(-1==d.maxWordCount||c<=d.maxWordCount)&&(-1==d.maxCharCount||s<=d.maxCharCount)&&(-1==d.maxParagraphs||h<=d.maxParagraphs)?function(a){e=!1,a.config.Locked=0,u=n.getSnapshot(),g(a).className="cke_path_item"}(a):u=a.getSnapshot(),a.wordCount={paragraphs:h,wordCount:c,charCount:s},d.charCountGreaterThanMaxLengthEvent&&d.charCountLessThanMaxLengthEvent&&(s>d.maxCharCount&&d.maxCharCount>-1?d.charCountGreaterThanMaxLengthEvent(s,d.maxCharCount):d.charCountLessThanMaxLengthEvent(s,d.maxCharCount)),d.wordCountGreaterThanMaxLengthEvent&&d.wordCountLessThanMaxLengthEvent&&(c>d.maxWordCount&&d.maxWordCount>-1?d.wordCountGreaterThanMaxLengthEvent(c,d.maxWordCount):d.wordCountLessThanMaxLengthEvent(c,d.maxWordCount)),!0}}bbcodePluginLoaded=void 0!==n.plugins.bbcode,n.on("key",function(a){"source"===n.mode&&(clearTimeout(i),i=setTimeout(L.bind(this,a.editor),250))},n,null,100),n.on("change",function(n){clearTimeout(i),i=setTimeout(L.bind(this,n.editor),250)},n,null,100),n.on("uiSpace",function(a){n.elementMode===CKEDITOR.ELEMENT_MODE_INLINE?"top"==a.data.space&&(a.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+l(a.editor)+'" class="cke_path_item">&nbsp;</span></div>'):"bottom"==a.data.space&&(a.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+l(a.editor)+'" class="cke_path_item">&nbsp;</span></div>')},n,null,100),n.on("dataReady",function(n){L(n.editor)},n,null,100),n.on("paste",function(n){if(d.maxWordCount>0||d.maxCharCount>0||d.maxParagraphs>0){var a=-1,t=-1,r=-1;n.editor.fire("beforeGetData",{firedBy:"wordCount.onPaste"},n.editor);var o=n.editor.getData(!0);n.editor.fire("getData",{dataValue:o,firedBy:"wordCount.onPaste"},n.editor),o+=n.data.dataValue,d.showCharCount&&(t=w(o)),d.showWordCount&&(a=f(o)),d.showParagraphs&&(r=x(o)),null===h&&(h=new CKEDITOR.plugins.notification(n.editor,{message:n.editor.lang.wordcount.pasteWarning,type:"warning",duration:d.pasteWarningDuration})),d.maxCharCount>0&&t>d.maxCharCount&&d.hardLimit&&(h.isVisible()||h.show(),n.cancel()),d.maxWordCount>0&&a>d.maxWordCount&&d.hardLimit&&(h.isVisible()||h.show(),n.cancel()),d.maxParagraphs>0&&r>d.maxParagraphs&&d.hardLimit&&(h.isVisible()||h.show(),n.cancel())}},n,null,100),n.on("afterPaste",function(n){L(n.editor)},n,null,100)}});